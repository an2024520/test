# AI 开发者规则与知识库 > **最后更新:** 2025/12/28 > **适用范围:** 项目专用合规性与编码标准 > ⚠️ **关键警告 (Sing-box):** > 1. 当前最新稳定版本为 **v1.12.14**（pre-release 为 v1.13.0-alpha.xx 系列）。 > 2. 在修改任何 Sing-box 配置之前，你**必须**严格遵守迁移指南： >    **文件路径:** `singbox/docs/migration.md`（关键内容已摘录在本文件末尾）。 > 3. v1.12.0 起 DNS server 格式重大变更：废弃 `address` 字段，统一使用 `type` + `server`。 > 4. geoip/geosite 已废弃（v1.8.0+ 起），v1.12.0 完全移除，必须迁移到 `rule_set`。 > 5. 所有生成的 Sing-box 配置必须建议用户运行 `sing-box check` 进行验证。 > ⚠️ **关键警告 (Xray-core):** > 1. 当前最新版本为 **v25.12.8**（日期命名体系 vYY.MM.DD）。 > 2. 代码库中默认安装版本为 **v25.12.8**。 > ⚠️ **关键警告 (代码库):** > 1. 代码库中默认安装的最新版本 Sing-box 为 **v1.12.14**。 > 2. 始终优先建议用户运行 `./sing-box version` 和 `./xray version` 检查实际安装版本。 --- ## 1. Sing-box 合规规范 (v1.12.14+) ### 1.1 编码标准 (Coding Standards) * **Systemd**: 服务以 `User=root` 身份运行，因此文件权限（日志、配置文件）**必须**设置为 `root:root`。 * **IPv6 处理**: 在进行 JSON 注入（例如使用 `jq`）时，**始终**要给 IPv6 地址加上双引号。 * **jq 语法**: 使用健壮的初始化写法以防止 null 错误： ```bash jq '.endpoints = (.endpoints // [])' ``` ### 1.2 WARP 规范 (WARP Specifics) * **命名约定**: WireGuard endpoint 的标签 (tag) **必须** 为 `"WARP"`。   * **禁忌**: **严禁**使用 `warp-endpoint` 等非标准名称并将其关联到 `WARP` 出站（会导致路由或握手失败）。 ### 1.3 Rule-Set 迁移规范 (v1.12+ 强制) * `geoip` / `geosite` 已完全移除，必须使用 `rule_set`（remote 或 local）。 * 必须启用缓存以避免重复下载： ```json "experimental": { "cache_file": { "enabled": true } } ``` * 标准示例（推荐使用 SagerNet 官方 rule-set）： ```json "route": { "rule_set": [ { "tag": "geoip-cn", "type": "remote", "format": "binary", "url": "https://raw.githubusercontent.com/SagerNet/sing-geoip/rule-set/geoip-cn.srs", "download_detour": "proxy" }, { "tag": "geosite-cn", "type": "remote", "format": "binary", "url": "https://raw.githubusercontent.com/SagerNet/sing-geosite/rule-set/geosite-cn.srs", "download_detour": "proxy" } ], "rules": [ { "rule_set": "geoip-cn", "outbound": "direct" }, { "rule_set": "geosite-cn", "outbound": "direct" }, { "ip_is_private": true, "outbound": "direct" } ] } ``` ### 1.4 迁移指南关键摘录 (v1.12.0+ 必读) 以下为官方 migration.md 的核心变更摘要，**AI 生成配置时必须遵守**： - **DNS Servers 重构**：废弃 `address`，统一使用 `type` + `server`： ```json // 旧（废弃） { "address": "tls://1.1.1.1" } // 新（必须） { "type": "tls", "server": "1.1.1.1" } ``` - **FakeIP、DHCP、RCode 等**均有专用 `type`。 - **Inbound sniff / domain_strategy** 迁移到 route rules： ```json // 新方式 "route": { "rules": [ { "inbound": "mixed-in", "action": "sniff", "timeout": "1s" }, { "inbound": "mixed-in", "action": "resolve", "strategy": "prefer_ipv4" } ] } ``` - **WireGuard outbound** 已废弃，迁移到 `endpoints`。 - **Destination override** 迁移到 route options。 - 更多细节请参考官方文档：https://sing-box.sagernet.org/migration/ --- ## 2. Xray-core 合规规范 (v25.12.8+) ### 2.1 VLESS 抗量子加密 (ML-KEM-768) * **注意**：后量子加密目前仅用于 VLESS 协议层。 * **关键词**：ENC, VLESS ENC, mlkem, ML-KEM-768, 抗量子加密。 * **最低版本**：v25.8.31+（推荐 v25.12.8+）。 * **密钥提取规范（必须严格遵守）**： ```bash # --- 1. Reality 密钥 (X25519) --- raw_reality=$(xray x25519) reality_private=$(echo "$raw_reality" | grep "Private" | awk -F ":" '{print $2}' | tr -d ' \r\n') reality_public=$(echo "$raw_reality" | grep -E "Password|Public" | awk -F ":" '{print $2}' | tr -d ' \r\n') reality_shortid=$(openssl rand -hex 8) # --- 2. VLESS ENC 密钥 (ML-KEM-768) --- raw_enc=$(xray vlessenc) mlkem_decryption=$(echo "$raw_enc" | grep '"decryption":' | head -n1 | awk -F '"' '{print $4}') mlkem_encryption=$(echo "$raw_enc" | grep '"encryption":' | head -n1 | awk -F '"' '{print $4}') # --- 3. 熔断检查 --- if [[ -z "$reality_private" ]] || [[ -z "$mlkem_decryption" ]]; then     echo "错误：密钥生成失败，请检查 Xray 版本或输出格式。"     exit 1 fi ``` * **服务端配置示例**（VLESS + ENC + XHTTP + Reality）： ```json { "inbounds": [ { "port": 443, "protocol": "vless", "settings": { "clients": [{ "id": "你的UUID", "flow": "" }], "decryption": "mlkem_decryption_密钥" }, "streamSettings": { "network": "xhttp", "security": "reality", "xhttpSettings": { "mode": "auto", "path": "/路径", "host": "SNI" }, "realitySettings": { "show": false, "dest": "www.apple.com:443", "serverNames": ["www.apple.com"], "privateKey": "reality_private_密钥", "shortIds": ["reality_shortid"] } } } ] } ``` * **客户端分享链接示例**： ``` vless://UUID@IP:443?encryption=MLKEM_ENCRYPTION_KEY&security=reality&sni=www.apple.com&fp=chrome&pbk=REALITY_PUBLIC_KEY&sid=SHORTID&type=xhttp&path=/路径&mode=auto#节点名 ``` ### 2.2 ECH 支持 (Encrypted Client Hello) * **最低版本**：v25.7.26+。 * **功能**：隐藏真实 SNI，常用于强制 Cloudflare CDN 的 ECH 直连。 * **配置位置**：`tlsSettings.ech` 对象。 * **关键参数**： ```json "tlsSettings": { "ech": { "enabled": true, "echConfig": "从公共源获取的 ECH 配置", "echForceQuery": "full"  // 或 "half"/"none" } } ``` * **注意**：需配合 Reality 或独立 TLS 使用，客户端需支持 ECH。 ### 2.3 待更新... --- **最终提醒**：AI 生成的任何配置仅供参考，必须由用户手动验证并测试连通性。禁止直接用于生产环境而不经检查。
